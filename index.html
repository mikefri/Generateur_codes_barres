<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G√©n√©rateur A4 & Code-Barres</title>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

  <style>
    :root { --bg:#1e1e2e; --panel:#2d2d44; --text:#cdd6f4; --accent:#89b4fa; }
    body { 
      font-family: system-ui, sans-serif; 
      background: var(--bg); 
      color: var(--text); 
      margin: 0; 
      padding: 20px; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      min-height: 100vh;
    }

    /* --- PANNEAU DE CONTROLE --- */
    .controls {
      background: var(--panel);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 800px;
      margin-bottom: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    input[type="text"], select {
      padding: 10px; border-radius: 6px; border: 1px solid #555;
      background: #333; color: white; flex: 1; font-size: 16px;
    }
    
    /* Slider de taille */
    .range-group { flex: 1; display: flex; align-items: center; gap: 10px; background: #333; padding: 5px 15px; border-radius: 6px; }
    input[type="range"] { flex: 1; cursor: pointer; }
    
    button {
      padding: 10px 20px; border-radius: 6px; border: none;
      background: var(--accent); color: white; font-weight: bold;
      cursor: pointer; font-size: 16px;
    }
    button:hover { opacity: 0.9; }
    button.print-btn { background: #2ecc71; }

    /* --- FEUILLE A4 (APER√áU) --- */
    .sheet-container {
      perspective: 1000px;
      margin-bottom: 50px;
    }
    
    .a4-page {
      width: 210mm;
      height: 297mm;
      background: white;
      color: black;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      display: flex;
      justify-content: center; /* Centr√© horizontalement */
      align-items: center;     /* Centr√© verticalement */
      overflow: hidden;
      transition: transform 0.3s;
    }

    /* Le conteneur du code qui sera redimensionn√© */
    #barcode-wrapper {
      transform-origin: center center;
      text-align: center;
    }

    /* --- GESTION DE L'IMPRESSION --- */
    @media print {
      body { 
        background: white; 
        margin: 0; padding: 0; 
        display: block; 
      }
      .controls, h1, p { display: none !important; } /* Cache l'interface */
      .sheet-container { margin: 0; box-shadow: none; }
      .a4-page {
        width: 100%; height: 100vh; /* Force la pleine page */
        box-shadow: none;
        border: none;
        page-break-after: always;
      }
      @page { margin: 0; size: A4; }
    }
  </style>
</head>
<body>

  <div class="controls">
    <div style="text-align:center; color:var(--accent); font-weight:bold; font-size:1.2em;">
      Configuration
    </div>
    
    <div class="row">
      <input type="text" id="texte" value="TEST-1234" placeholder="Donn√©es du code">
      <select id="type">
        <option value="CODE128" selected>Code 128</option>
        <option value="EAN13">EAN-13</option>
        <option value="QRCODE">QR Code</option>
      </select>
    </div>

    <div class="row">
      <div class="range-group">
        <span>Taille :</span>
        <input type="range" id="sizeSlider" min="0.5" max="3" step="0.1" value="1">
        <span id="sizeValue">100%</span>
      </div>
      <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimer la page</button>
    </div>
  </div>

  <div class="sheet-container">
    <div class="a4-page">
      <div id="barcode-wrapper">
        <div id="canvas-target"></div>
      </div>
    </div>
  </div>

  <script>
    const inputTexte = document.getElementById("texte");
    const inputType = document.getElementById("type");
    const slider = document.getElementById("sizeSlider");
    const sizeVal = document.getElementById("sizeValue");
    const target = document.getElementById("canvas-target");
    const wrapper = document.getElementById("barcode-wrapper");

    function generer() {
      const texte = inputTexte.value.trim();
      const type = inputType.value;
      
      target.innerHTML = ""; // Reset

      if (!texte && type !== "QRCODE") return;

      try {
        if (type === "CODE128") {
          const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          target.appendChild(svg);
          JsBarcode(svg, texte, {
            format: "CODE128",
            lineColor: "#000",
            background: "transparent", // Transparent pour s'int√©grer √† la page blanche
            displayValue: true,
            fontSize: 20,
            height: 100,
            margin: 0
          });

        } else if (type === "EAN13") {
          let num = texte.replace(/\D/g, "");
          if (num.length === 12) num += calculCheckDigit(num);
          
          if (num.length !== 13) throw new Error("12/13 chiffres requis");

          const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          target.appendChild(svg);
          JsBarcode(svg, num, {
            format: "EAN13",
            lineColor: "#000",
            background: "transparent",
            displayValue: true,
            fontSize: 24,
            height: 100,
            margin: 0
          });

        } else if (type === "QRCODE") {
          const canvas = document.createElement("canvas");
          target.appendChild(canvas);
          QRCode.toCanvas(canvas, texte || "https://exemple.com", {
            width: 200,
            margin: 0,
            color: { dark: "#000000", light: "#ffffff" }
          });
        }
      } catch (e) {
        target.innerHTML = `<span style='color:red; font-weight:bold'>${e.message}</span>`;
      }
    }

    // Gestion de la taille (Zoom CSS)
    function updateSize() {
      const scale = slider.value;
      sizeVal.innerText = Math.round(scale * 100) + "%";
      wrapper.style.transform = `scale(${scale})`;
    }

    function calculCheckDigit(ean12) {
      let sum = 0;
      for (let i = 0; i < 12; i++) sum += (i % 2 === 0 ? 1 : 3) * parseInt(ean12[i]);
      const rem = sum % 10;
      return rem === 0 ? 0 : 10 - rem;
    }

    // √âv√©nements
    inputTexte.addEventListener("input", generer);
    inputType.addEventListener("change", generer);
    slider.addEventListener("input", updateSize);

    // Init
    generer();
  </script>
</body>
</html>
